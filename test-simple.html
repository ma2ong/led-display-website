<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•æµ‹è¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-box { 
            border: 2px solid #007bff; 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 5px; 
        }
        .success { border-color: #28a745; background-color: #d4edda; }
        .error { border-color: #dc3545; background-color: #f8d7da; }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        #log { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            padding: 10px; 
            height: 200px; 
            overflow-y: auto; 
            font-family: monospace; 
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ äº§å“è¡¨ä¿®å¤å·¥å…· - è¶…ç®€ç‰ˆ</h1>
    
    <div class="test-box">
        <h3>æ­¥éª¤1: åŸºç¡€æµ‹è¯•</h3>
        <button onclick="testBasic()">æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
        <div id="basic-result"></div>
    </div>
    
    <div class="test-box">
        <h3>æ­¥éª¤2: Supabaseè¿æ¥</h3>
        <button onclick="testSupabase()">æµ‹è¯•Supabaseè¿æ¥</button>
        <div id="supabase-result"></div>
    </div>
    
    <div class="test-box">
        <h3>æ­¥éª¤3: äº§å“è¡¨æ“ä½œ</h3>
        <button onclick="testProducts()">æµ‹è¯•äº§å“è¡¨</button>
        <div id="products-result"></div>
    </div>
    
    <div class="test-box">
        <h3>æ­¥éª¤4: æ’å…¥æµ‹è¯•æ•°æ®</h3>
        <button onclick="insertTestData()">æ’å…¥æµ‹è¯•äº§å“</button>
        <div id="insert-result"></div>
    </div>
    
    <div class="test-box">
        <h3>æ“ä½œæ—¥å¿—</h3>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        <div id="log"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const colors = {
                info: '#007bff',
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107'
            };
            logDiv.innerHTML += `<div style="color: ${colors[type]};">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${success ? 'success' : 'error'} test-box">${message}</div>`;
        }
        
        // Supabaseé…ç½®
        const supabaseUrl = 'https://tfkzzgufbftlafsdyrmj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRma3p6Z3VmYmZ0bGFmc2R5cm1qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzODQxOTQsImV4cCI6MjA2OTk2MDE5NH0.z5VqNaBohG-9Kwm3thBnrgAca8bePxnbBamFCBiXoLY';
        
        let supabaseClient = null;
        
        // æµ‹è¯•1: åŸºç¡€åŠŸèƒ½
        function testBasic() {
            log('å¼€å§‹åŸºç¡€åŠŸèƒ½æµ‹è¯•...');
            
            try {
                // æµ‹è¯•JavaScriptåŸºç¡€åŠŸèƒ½
                const testArray = [1, 2, 3];
                const testObject = { name: 'test', value: 123 };
                
                if (testArray.length === 3 && testObject.name === 'test') {
                    log('âœ… JavaScriptåŸºç¡€åŠŸèƒ½æ­£å¸¸', 'success');
                    showResult('basic-result', true, 'âœ… åŸºç¡€åŠŸèƒ½æµ‹è¯•é€šè¿‡');
                } else {
                    throw new Error('åŸºç¡€åŠŸèƒ½æµ‹è¯•å¤±è´¥');
                }
                
                // æµ‹è¯•Supabaseåº“æ˜¯å¦åŠ è½½
                if (typeof window.supabase !== 'undefined') {
                    log('âœ… Supabaseåº“å·²åŠ è½½', 'success');
                } else {
                    throw new Error('Supabaseåº“æœªåŠ è½½');
                }
                
            } catch (error) {
                log('âŒ åŸºç¡€åŠŸèƒ½æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
                showResult('basic-result', false, 'âŒ åŸºç¡€åŠŸèƒ½æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }
        
        // æµ‹è¯•2: Supabaseè¿æ¥
        async function testSupabase() {
            log('å¼€å§‹Supabaseè¿æ¥æµ‹è¯•...');
            
            try {
                // åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯
                supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
                log('âœ… Supabaseå®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ', 'success');
                
                // æµ‹è¯•è¿æ¥
                const { data, error } = await supabaseClient
                    .from('products')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    throw new Error('è¿æ¥å¤±è´¥: ' + error.message);
                }
                
                log('âœ… Supabaseè¿æ¥æµ‹è¯•æˆåŠŸ', 'success');
                showResult('supabase-result', true, 'âœ… Supabaseè¿æ¥æ­£å¸¸');
                
            } catch (error) {
                log('âŒ Supabaseè¿æ¥å¤±è´¥: ' + error.message, 'error');
                showResult('supabase-result', false, 'âŒ è¿æ¥å¤±è´¥: ' + error.message);
            }
        }
        
        // æµ‹è¯•3: äº§å“è¡¨æ“ä½œ
        async function testProducts() {
            log('å¼€å§‹äº§å“è¡¨æµ‹è¯•...');
            
            if (!supabaseClient) {
                log('âŒ è¯·å…ˆæµ‹è¯•Supabaseè¿æ¥', 'error');
                showResult('products-result', false, 'âŒ è¯·å…ˆæµ‹è¯•Supabaseè¿æ¥');
                return;
            }
            
            try {
                // æµ‹è¯•è¯»å–äº§å“è¡¨
                const { data, error } = await supabaseClient
                    .from('products')
                    .select('*')
                    .limit(5);
                
                if (error) {
                    throw new Error('è¯»å–äº§å“è¡¨å¤±è´¥: ' + error.message);
                }
                
                log(`âœ… æˆåŠŸè¯»å–äº§å“è¡¨ï¼Œå…±${data.length}æ¡è®°å½•`, 'success');
                showResult('products-result', true, `âœ… äº§å“è¡¨è¯»å–æ­£å¸¸ï¼Œå…±${data.length}æ¡è®°å½•`);
                
            } catch (error) {
                log('âŒ äº§å“è¡¨æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
                showResult('products-result', false, 'âŒ äº§å“è¡¨æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }
        
        // æµ‹è¯•4: æ’å…¥æµ‹è¯•æ•°æ®
        async function insertTestData() {
            log('å¼€å§‹æ’å…¥æµ‹è¯•æ•°æ®...');
            
            if (!supabaseClient) {
                log('âŒ è¯·å…ˆæµ‹è¯•Supabaseè¿æ¥', 'error');
                showResult('insert-result', false, 'âŒ è¯·å…ˆæµ‹è¯•Supabaseè¿æ¥');
                return;
            }
            
            try {
                const testProduct = {
                    name: 'æµ‹è¯•LEDæ˜¾ç¤ºå±_' + Date.now(),
                    category: 'Indoor',
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•äº§å“',
                    price: 2999.99,
                    image_url: 'assets/products/test.jpg',
                    specifications: '{"resolution": "1920x1080", "brightness": "500 nits"}'
                };
                
                log('å‡†å¤‡æ’å…¥æ•°æ®: ' + JSON.stringify(testProduct));
                
                const { data, error } = await supabaseClient
                    .from('products')
                    .insert(testProduct)
                    .select();
                
                if (error) {
                    throw new Error('æ’å…¥å¤±è´¥: ' + error.message + ' (ä»£ç : ' + (error.code || 'N/A') + ')');
                }
                
                log('âœ… æµ‹è¯•æ•°æ®æ’å…¥æˆåŠŸï¼äº§å“ID: ' + data[0].id, 'success');
                showResult('insert-result', true, `âœ… æ’å…¥æˆåŠŸï¼äº§å“: ${data[0].name} (ID: ${data[0].id})`);
                
            } catch (error) {
                log('âŒ æ’å…¥æµ‹è¯•æ•°æ®å¤±è´¥: ' + error.message, 'error');
                showResult('insert-result', false, 'âŒ æ’å…¥å¤±è´¥: ' + error.message);
                
                // æä¾›è§£å†³å»ºè®®
                if (error.message.includes('RLS') || error.message.includes('policy')) {
                    log('ğŸ’¡ å»ºè®®: éœ€è¦ç¦ç”¨RLSï¼Œè¯·åœ¨Supabase SQLç¼–è¾‘å™¨ä¸­æ‰§è¡Œ: ALTER TABLE products DISABLE ROW LEVEL SECURITY;', 'warning');
                }
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            log('ğŸš€ äº§å“è¡¨ä¿®å¤å·¥å…·å·²åŠ è½½å®Œæˆ');
            log('ğŸ“‹ è¯·æŒ‰é¡ºåºæ‰§è¡Œæµ‹è¯•: åŸºç¡€æµ‹è¯• â†’ Supabaseè¿æ¥ â†’ äº§å“è¡¨æµ‹è¯• â†’ æ’å…¥æ•°æ®');
        });
    </script>
</body>
</html>