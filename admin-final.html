<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED显示屏管理系统 (Final)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; background: #f8f9fa; }
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-card { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; max-width: 400px; width: 100%; }
        .login-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .admin-dashboard { display: none; }
        .sidebar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: white; }
        .sidebar .nav-link { color: rgba(255,255,255,0.9); padding: 15px 20px; border-radius: 0; transition: all 0.3s; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background: rgba(255,255,255,0.1); color: white; }
        .main-content { background: #f8f9fa; min-height: 100vh; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .stats-card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .product-card { background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <!-- Login UI -->
    <div id="login-section" class="login-container">
        <div class="login-card">
            <div class="login-header"><h3><i class="fas fa-tv me-2"></i>LED管理系统</h3><p class="mb-0">在线管理后台 (Final)</p></div>
            <div class="p-4">
                <form id="login-form">
                    <div class="mb-3"><label class="form-label">用户名</label><input type="text" class="form-control" id="username" value="admin" required></div>
                    <div class="mb-3"><label class="form-label">密码</label><input type="password" class="form-control" id="password" value="admin123" required></div>
                    <button type="submit" class="btn btn-primary w-100"><i class="fas fa-sign-in-alt me-2"></i>登录</button>
                </form>
                <div id="login-message" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Dashboard UI -->
    <div id="admin-dashboard" class="admin-dashboard">
        <div class="row g-0">
            <div class="col-md-3 col-lg-2">
                <div class="sidebar">
                    <div class="p-3 text-center border-bottom border-light border-opacity-25"><h5><i class="fas fa-tv me-2"></i>LED管理系统</h5></div>
                    <nav class="nav flex-column">
                        <a class="nav-link active" href="#" data-section="dashboard"><i class="fas fa-tachometer-alt me-2"></i>仪表盘</a>
                        <a class="nav-link" href="#" data-section="products"><i class="fas fa-cube me-2"></i>产品管理</a>
                        <a class="nav-link" href="#" data-section="inquiries"><i class="fas fa-envelope me-2"></i>询盘管理</a>
                        <a class="nav-link" href="#" data-section="news"><i class="fas fa-newspaper me-2"></i>新闻管理</a>
                        <a class="nav-link" href="#" data-section="settings"><i class="fas fa-cog me-2"></i>系统设置</a>
                        <a class="nav-link" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>退出登录</a>
                    </nav>
                </div>
            </div>
            <div class="col-md-9 col-lg-10">
                <div class="main-content p-4">
                    <!-- Dashboard Section -->
                    <div id="dashboard-section" class="content-section active">
                        <h2><i class="fas fa-tachometer-alt me-2"></i>仪表盘</h2>
                        <div class="row">
                            <div class="col-md-3"><div class="stats-card text-center"><i class="fas fa-cube fa-2x text-primary mb-2"></i><h4 id="total-products">0</h4><p class="text-muted">总产品数</p></div></div>
                            <div class="col-md-3"><div class="stats-card text-center"><i class="fas fa-envelope fa-2x text-success mb-2"></i><h4 id="total-inquiries">0</h4><p class="text-muted">询盘数量</p></div></div>
                            <div class="col-md-3"><div class="stats-card text-center"><i class="fas fa-newspaper fa-2x text-info mb-2"></i><h4 id="total-news">0</h4><p class="text-muted">新闻文章</p></div></div>
                            <div class="col-md-3"><div class="stats-card text-center"><i class="fas fa-check-circle fa-2x text-success mb-2"></i><h4>在线</h4><p class="text-muted">系统状态</p></div></div>
                        </div>
                    </div>
                    <!-- Products Section -->
                    <div id="products-section" class="content-section">
                        <div class="d-flex justify-content-between align-items-center mb-4"><h2><i class="fas fa-cube me-2"></i>产品管理</h2><button class="btn btn-primary" onclick="showAddProductModal()"><i class="fas fa-plus me-2"></i>添加产品</button></div>
                        <div id="products-list"><div class="text-center py-4"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">加载中...</span></div></div></div>
                    </div>
                    <!-- Other sections... -->
                    <div id="inquiries-section" class="content-section"><h2><i class="fas fa-envelope me-2"></i>询盘管理</h2><div id="inquiries-list"><div class="alert alert-info">暂无询盘数据</div></div></div>
                    <div id="news-section" class="content-section"><h2><i class="fas fa-newspaper me-2"></i>新闻管理</h2><div id="news-list"><div class="alert alert-info">暂无新闻数据</div></div></div>
                    <div id="settings-section" class="content-section"><h2><i class="fas fa-cog me-2"></i>系统设置</h2><div class="stats-card"><h5>数据库连接</h5><p>Supabase: <span class="badge bg-success">已连接</span></p></div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1">
        <div class="modal-dialog"><div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">添加产品</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <form id="add-product-form">
                    <div class="mb-3"><label class="form-label">产品名称</label><input type="text" class="form-control" name="name" required></div>
                    <div class="mb-3"><label class="form-label">产品类别</label><select class="form-control" name="category" required><option value="">选择类别</option><option value="Indoor">室内</option><option value="Outdoor">户外</option></select></div>
                    <div class="mb-3"><label class="form-label">产品描述</label><textarea class="form-control" name="description" rows="3"></textarea></div>
                    <div class="mb-3"><label class="form-label">价格</label><input type="number" class="form-control" name="price" step="0.01"></div>
                </form>
            </div>
            <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button><button type="button" class="btn btn-primary" onclick="addProduct()">添加</button></div>
        </div></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // CORRECTED Supabase Initialization
        const supabaseUrl = 'https://jirudzbqcxviytcmxegf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImppcnVkemJxY3h2aXl0Y218ZWdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0NTExOTUsImV4cCI6MjA3MDAyNzE5NX0.qi0YhrxQmbRa6YsbVA13IpddImIjJKJyd1fgz5jIlt4';
        const { createClient } = supabase;
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        // Login function
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('login-message');
            
            if (username === 'admin' && password === 'admin123') {
                messageDiv.innerHTML = '<div class="alert alert-success">登录成功！</div>';
                setTimeout(() => {
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('admin-dashboard').style.display = 'block';
                    loadDashboardData();
                }, 1000);
            } else {
                messageDiv.innerHTML = '<div class="alert alert-danger">用户名或密码错误！</div>';
            }
        });

        // Navigation
        document.querySelectorAll('.nav-link[data-section]').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                const section = link.getAttribute('data-section');
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                document.getElementById(section + '-section').classList.add('active');
                if (section === 'products') loadProducts();
            });
        });

        // Load dashboard data
        async function loadDashboardData() {
            const { data: products, error } = await supabaseClient.from('products').select('id');
            if (!error) document.getElementById('total-products').textContent = products.length;
        }

        // Load products
        async function loadProducts() {
            const container = document.getElementById('products-list');
            container.innerHTML = '<div class="text-center py-4"><div class="spinner-border text-primary"></div></div>';
            const { data: products, error } = await supabaseClient.from('products').select('*').order('created_at', { ascending: false });
            if (error || !products.length) {
                container.innerHTML = '<div class="alert alert-info">暂无产品数据</div>';
                return;
            }
            container.innerHTML = products.map(p => `
                <div class="product-card d-flex justify-content-between align-items-start">
                    <div>
                        <h5>${p.name}</h5>
                        <p class="text-muted mb-1">${p.description || '暂无描述'}</p>
                        <span class="badge bg-primary">${p.category}</span>
                    </div>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct('${p.id}')"><i class="fas fa-trash"></i></button>
                </div>`).join('');
        }

        // Add/Delete/Show Modal functions
        let productModal;
        function showAddProductModal() {
            if (!productModal) productModal = new bootstrap.Modal(document.getElementById('addProductModal'));
            productModal.show();
        }
        async function addProduct() {
            const form = document.getElementById('add-product-form');
            const formData = new FormData(form);
            const productData = { name: formData.get('name'), category: formData.get('category'), description: formData.get('description'), price: parseFloat(formData.get('price')) || null };
            const { error } = await supabaseClient.from('products').insert([productData]);
            if (error) { alert('添加失败: ' + error.message); }
            else {
                alert('添加成功！');
                productModal.hide();
                form.reset();
                loadProducts();
                loadDashboardData();
            }
        }
        async function deleteProduct(id) {
            if (!confirm('确定删除?')) return;
            const { error } = await supabaseClient.from('products').delete().eq('id', id);
            if (error) { alert('删除失败: ' + error.message); }
            else {
                loadProducts();
                loadDashboardData();
            }
        }
        function logout() {
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('login-section').style.display = 'flex';
        }
    </script>
</body>
</html>