# Supabase 404 错误修复指南

## 问题描述

在尝试向 Supabase 数据库写入数据时遇到 404 错误，表明请求的资源（表）不存在。

## 可能的原因

1. **表不存在**：尝试写入的表在 Supabase 数据库中不存在
2. **表名大小写不匹配**：Supabase 表名区分大小写
3. **API 路径错误**：REST API 路径格式不正确
4. **权限问题**：没有足够的权限访问或修改表

## 解决方案

### 1. 确认表是否存在

首先，我们需要确认 Supabase 数据库中存在哪些表。可以通过以下方式：

- 在 Supabase 控制台中查看表列表
- 使用 API 查询系统表获取表信息
- 尝试对表执行只读操作（如 SELECT）来验证表是否存在

### 2. 创建缺失的表

如果表不存在，需要创建表。可以通过以下 SQL 语句创建基本表：

```sql
-- 创建产品表
CREATE TABLE products (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  price NUMERIC,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- 创建询盘表
CREATE TABLE inquiries (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  email TEXT NOT NULL,
  message TEXT NOT NULL,
  status TEXT DEFAULT 'new',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- 创建新闻表
CREATE TABLE news (
  id SERIAL PRIMARY KEY,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  author TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- 创建待办事项表
CREATE TABLE todos (
  id SERIAL PRIMARY KEY,
  task TEXT NOT NULL,
  is_complete BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);
```

### 3. 修复 API 调用

确保 API 调用使用正确的表名和格式：

```javascript
// 正确的 API 调用格式
fetch(`${supabaseUrl}/rest/v1/表名`, {
  method: 'POST',  // 或 GET, PUT, DELETE 等
  headers: {
    'apikey': supabaseKey,
    'Authorization': `Bearer ${supabaseKey}`,
    'Content-Type': 'application/json',
    'Prefer': 'return=representation'  // 用于返回插入/更新后的数据
  },
  body: JSON.stringify(数据对象)  // 仅适用于 POST, PUT 等
});
```

### 4. 检查表结构

确保提交的数据与表结构匹配：

- 检查必填字段是否都已提供
- 检查字段名称是否正确（区分大小写）
- 检查字段类型是否匹配（如数字字段不能传字符串）

### 5. 检查权限设置

确保 API 密钥有足够的权限：

- 检查 Supabase 项目的 RLS（行级安全）策略
- 确认匿名用户是否有写入权限
- 如需要，调整表的安全策略

## 测试步骤

1. 使用修复版测试页面 `fixed-supabase-test.html`
2. 首先点击"列出所有表"按钮，确认哪些表存在
3. 点击"测试连接"按钮，验证基本连接是否正常
4. 尝试对存在的表执行写入操作
5. 根据错误信息进一步调整

## 常见错误代码解释

- **404 Not Found**：表不存在或 API 路径错误
- **401 Unauthorized**：API 密钥无效或缺失
- **403 Forbidden**：没有足够的权限执行操作
- **400 Bad Request**：请求格式错误或数据不符合要求
- **500 Internal Server Error**：服务器内部错误

完成以上步骤后，应该能够解决 404 错误问题，成功向 Supabase 数据库写入数据。