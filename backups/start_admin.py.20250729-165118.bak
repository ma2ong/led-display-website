#!/usr/bin/env python3
"""
LED Display Admin Panel Startup Script
å¯åŠ¨LEDæ˜¾ç¤ºå±ç®¡ç†åå°ç³»ç»Ÿ
"""

import os
import sys
import subprocess
import webbrowser
from pathlib import Path

def check_requirements():
    """æ£€æŸ¥Pythonä¾èµ–"""
    try:
        import flask
        print("âœ… Flaskå·²å®‰è£…")
    except ImportError:
        print("âŒ Flaskæœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…...")
        subprocess.check_call([sys.executable, "-m", "pip", "install", "flask"])
        print("âœ… Flaskå®‰è£…å®Œæˆ")
    
    try:
        import werkzeug
        print("âœ… Werkzeugå·²å®‰è£…")
    except ImportError:
        print("âŒ Werkzeugæœªå®‰è£…ï¼Œæ­£åœ¨å®‰è£…...")
        subprocess.check_call([sys.executable, "-m", "pip", "install", "werkzeug"])
        print("âœ… Werkzeugå®‰è£…å®Œæˆ")

def main():
    """å¯åŠ¨ç®¡ç†åå°"""
    print("ğŸš€ LEDæ˜¾ç¤ºå±ç®¡ç†åå°å¯åŠ¨å™¨")
    print("=" * 50)
    
    # æ£€æŸ¥ä¾èµ–
    print("ğŸ“¦ æ£€æŸ¥ä¾èµ–åŒ…...")
    check_requirements()
    
    # åˆ‡æ¢åˆ°adminç›®å½•
    admin_dir = Path(__file__).parent
    os.chdir(admin_dir)
    
    print("ğŸ“ å·¥ä½œç›®å½•:", admin_dir)
    print("=" * 50)
    
    # å¯åŠ¨Flaskåº”ç”¨
    try:
        print("ğŸŒ å¯åŠ¨ç®¡ç†åå°æœåŠ¡...")
        print("ğŸ“ ç®¡ç†åå°åœ°å€: http://localhost:5000")
        print("ğŸ‘¤ é»˜è®¤ç™»å½•è´¦æˆ·:")
        print("   ç”¨æˆ·å: admin")
        print("   å¯†ç : admin123")
        print("=" * 50)
        print("ğŸ’¡ æç¤º:")
        print("   â€¢ é¦–æ¬¡ç™»å½•åè¯·åŠæ—¶ä¿®æ”¹å¯†ç ")
        print("   â€¢ æŒ‰ Ctrl+C åœæ­¢æœåŠ¡")
        print("   â€¢ ç®¡ç†åå°æ•°æ®å­˜å‚¨åœ¨ led_admin.db")
        print("=" * 50)
        
        # å°è¯•è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
        try:
            print("ğŸŒ æ­£åœ¨æ‰“å¼€æµè§ˆå™¨...")
            webbrowser.open('http://localhost:5000')
        except Exception as e:
            print(f"âš ï¸  æ— æ³•è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨: {e}")
            print("è¯·æ‰‹åŠ¨è®¿é—®: http://localhost:5000")
        
        print("\nâœ… ç®¡ç†åå°å¯åŠ¨æˆåŠŸ!")
        print("ç­‰å¾…è¯·æ±‚... (æŒ‰ Ctrl+C åœæ­¢)\n")
        
        # å¯åŠ¨Flaskåº”ç”¨
        from app import app
        app.run(debug=True, host='0.0.0.0', port=5000)
        
    except KeyboardInterrupt:
        print("\n\nğŸ›‘ ç®¡ç†åå°å·²åœæ­¢")
    except Exception as e:
        print(f"\nâŒ å¯åŠ¨å¤±è´¥: {e}")
        print("è¯·æ£€æŸ¥ç«¯å£5000æ˜¯å¦è¢«å ç”¨")

if __name__ == "__main__":
    main()