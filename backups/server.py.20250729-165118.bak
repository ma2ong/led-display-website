#!/usr/bin/env python3
"""
Simple HTTP server for local development of the LED website.
Run this script to serve the website locally.
"""

import http.server
import socketserver
import webbrowser
import os
import sys
from pathlib import Path

# Configuration
PORT = 8000
HOST = 'localhost'

class CustomHTTPRequestHandler(http.server.SimpleHTTPRequestHandler):
    """Custom handler to serve files with proper MIME types"""
    
    def end_headers(self):
        # Add CORS headers for local development
        self.send_header('Access-Control-Allow-Origin', '*')
        self.send_header('Access-Control-Allow-Methods', 'GET, POST, OPTIONS')
        self.send_header('Access-Control-Allow-Headers', 'Content-Type')
        super().end_headers()
    
    def guess_type(self, path):
        """Override to handle additional file types"""
        mimetype, encoding = super().guess_type(path)
        
        # Handle specific file types
        if path.endswith('.js'):
            return 'application/javascript', encoding
        elif path.endswith('.css'):
            return 'text/css', encoding
        elif path.endswith('.json'):
            return 'application/json', encoding
        elif path.endswith('.woff2'):
            return 'font/woff2', encoding
        elif path.endswith('.woff'):
            return 'font/woff', encoding
        
        return mimetype, encoding

def main():
    """Start the development server"""
    
    # Change to the directory containing this script
    script_dir = Path(__file__).parent
    os.chdir(script_dir)
    
    # Check if index.html exists
    if not Path('index.html').exists():
        print("âŒ Error: index.html not found in current directory")
        print("Make sure you're running this script from the website root directory")
        sys.exit(1)
    
    try:
        # Create server
        with socketserver.TCPServer((HOST, PORT), CustomHTTPRequestHandler) as httpd:
            server_url = f"http://{HOST}:{PORT}"
            
            print("ğŸš€ LED Website Development Server")
            print("=" * 40)
            print(f"ğŸ“ Server running at: {server_url}")
            print(f"ğŸ“ Serving files from: {script_dir}")
            print("=" * 40)
            print("ğŸ“ Available pages:")
            print(f"   â€¢ Main website: {server_url}")
            print(f"   â€¢ Direct access: {server_url}/index.html")
            print("=" * 40)
            print("ğŸ’¡ Tips:")
            print("   â€¢ Press Ctrl+C to stop the server")
            print("   â€¢ Refresh browser to see changes")
            print("   â€¢ Check browser console for any errors")
            print("=" * 40)
            
            # Try to open browser automatically
            try:
                print("ğŸŒ Opening browser...")
                webbrowser.open(server_url)
            except Exception as e:
                print(f"âš ï¸  Could not open browser automatically: {e}")
                print(f"Please manually open: {server_url}")
            
            print("\nâœ… Server started successfully!")
            print("Waiting for requests... (Press Ctrl+C to stop)\n")
            
            # Start serving
            httpd.serve_forever()
            
    except KeyboardInterrupt:
        print("\n\nğŸ›‘ Server stopped by user")
    except OSError as e:
        if e.errno == 48:  # Address already in use
            print(f"âŒ Error: Port {PORT} is already in use")
            print("Try using a different port or stop the other server")
        else:
            print(f"âŒ Error starting server: {e}")
    except Exception as e:
        print(f"âŒ Unexpected error: {e}")

if __name__ == "__main__":
    main()

"""
ä¸­æ–‡ä½¿ç”¨è¯´æ˜ï¼š

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼Œç”¨äºåœ¨æœ¬åœ°è¿è¡ŒLEDç½‘ç«™ã€‚

ä½¿ç”¨æ–¹æ³•ï¼š
1. ç¡®ä¿æ‚¨å·²å®‰è£…Python 3
2. åœ¨å‘½ä»¤è¡Œä¸­å¯¼èˆªåˆ°ç½‘ç«™æ–‡ä»¶å¤¹
3. è¿è¡Œå‘½ä»¤ï¼špython server.py
4. æœåŠ¡å™¨å°†è‡ªåŠ¨å¯åŠ¨å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç½‘ç«™
5. é»˜è®¤åœ°å€ï¼šhttp://localhost:8000

åŠŸèƒ½ç‰¹ç‚¹ï¼š
- è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
- æ”¯æŒæ‰€æœ‰ç½‘ç«™æ–‡ä»¶ç±»å‹
- å®æ—¶æŸ¥çœ‹ç½‘ç«™ä¿®æ”¹æ•ˆæœ
- æŒ‰Ctrl+Cåœæ­¢æœåŠ¡å™¨

æ³¨æ„äº‹é¡¹ï¼š
- ç¡®ä¿index.htmlæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹
- å¦‚æœç«¯å£8000è¢«å ç”¨ï¼Œä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- ä¿®æ”¹ç½‘ç«™æ–‡ä»¶åï¼Œåˆ·æ–°æµè§ˆå™¨å³å¯çœ‹åˆ°æ›´æ–°

è¿™ä¸ªæœåŠ¡å™¨ä»…ç”¨äºæœ¬åœ°å¼€å‘æµ‹è¯•ï¼Œä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚
"""
