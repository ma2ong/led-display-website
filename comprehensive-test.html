<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»¼åˆåŠŸèƒ½æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-section {
            margin-bottom: 2rem;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            padding: 1.5rem;
        }
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.25rem;
        }
        .test-success {
            background-color: #d1edff;
            border: 1px solid #0ea5e9;
            color: #0369a1;
        }
        .test-error {
            background-color: #fee2e2;
            border: 1px solid #ef4444;
            color: #dc2626;
        }
        .test-warning {
            background-color: #fef3c7;
            border: 1px solid #f59e0b;
            color: #d97706;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">
            <i class="fas fa-flask text-primary"></i>
            LED ç½‘ç«™ç»¼åˆåŠŸèƒ½æµ‹è¯•
        </h1>
        
        <!-- é¡µé¢åŠ è½½æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-globe text-info"></i> é¡µé¢åŠ è½½æµ‹è¯•</h3>
            <p class="text-muted">æµ‹è¯•ä¸»è¦é¡µé¢æ˜¯å¦èƒ½æ­£å¸¸åŠ è½½</p>
            <div class="row">
                <div class="col-md-6">
                    <button class="btn btn-outline-primary btn-sm me-2" onclick="testPage('index.html')">ä¸»é¡µ</button>
                    <button class="btn btn-outline-primary btn-sm me-2" onclick="testPage('products.html')">äº§å“</button>
                    <button class="btn btn-outline-primary btn-sm me-2" onclick="testPage('about.html')">å…³äº</button>
                    <button class="btn btn-outline-primary btn-sm me-2" onclick="testPage('contact.html')">è”ç³»</button>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-outline-success btn-sm me-2" onclick="testPage('admin-login.html')">ç®¡ç†ç™»å½•</button>
                    <button class="btn btn-outline-success btn-sm me-2" onclick="testPage('admin-complete-supabase.html')">ç®¡ç†ç³»ç»Ÿ</button>
                </div>
            </div>
            <div id="page-test-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- Hero éƒ¨åˆ†æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-image text-warning"></i> Hero éƒ¨åˆ†æµ‹è¯•</h3>
            <p class="text-muted">æ£€æŸ¥ Hero éƒ¨åˆ†æ ·å¼æ˜¯å¦æ­£ç¡®åº”ç”¨</p>
            <button class="btn btn-warning" onclick="testHeroSections()">æµ‹è¯• Hero æ ·å¼</button>
            <div id="hero-test-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- æ•°æ®åº“è¿æ¥æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-database text-success"></i> æ•°æ®åº“è¿æ¥æµ‹è¯•</h3>
            <p class="text-muted">æµ‹è¯• Supabase æ•°æ®åº“è¿æ¥å’Œäº§å“æ•°æ®</p>
            <button class="btn btn-success me-2" onclick="testSupabaseConnection()">æµ‹è¯•è¿æ¥</button>
            <button class="btn btn-outline-success" onclick="testProductData()">æµ‹è¯•äº§å“æ•°æ®</button>
            <div id="db-test-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- API æ¥å£æµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-plug text-danger"></i> API æ¥å£æµ‹è¯•</h3>
            <p class="text-muted">æµ‹è¯•ç»Ÿä¸€ API æ¥å£åŠŸèƒ½</p>
            <button class="btn btn-danger me-2" onclick="testUnifiedAPI()">æµ‹è¯•ç»Ÿä¸€ API</button>
            <button class="btn btn-outline-danger" onclick="testContactAPI()">æµ‹è¯•è”ç³»è¡¨å• API</button>
            <div id="api-test-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- ç®¡ç†ç³»ç»Ÿæµ‹è¯• -->
        <div class="test-section">
            <h3><i class="fas fa-cog text-secondary"></i> ç®¡ç†ç³»ç»Ÿæµ‹è¯•</h3>
            <p class="text-muted">æµ‹è¯•ç®¡ç†ç³»ç»ŸåŠŸèƒ½</p>
            <button class="btn btn-secondary me-2" onclick="testAdminLogin()">æµ‹è¯•ç™»å½•åŠŸèƒ½</button>
            <button class="btn btn-outline-secondary" onclick="testAdminDashboard()">æµ‹è¯•ç®¡ç†é¢æ¿</button>
            <div id="admin-test-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- éƒ¨ç½²å‡†å¤‡æ£€æŸ¥ -->
        <div class="test-section">
            <h3><i class="fas fa-rocket text-primary"></i> éƒ¨ç½²å‡†å¤‡æ£€æŸ¥</h3>
            <p class="text-muted">æ£€æŸ¥é¡¹ç›®æ˜¯å¦å‡†å¤‡å¥½éƒ¨ç½²</p>
            <button class="btn btn-primary" onclick="checkDeploymentReadiness()">æ£€æŸ¥éƒ¨ç½²å‡†å¤‡</button>
            <div id="deployment-test-result" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <script type="module">
        import { getSupabaseClient } from './lib/supabase.js';
        
        const supabase = getSupabaseClient();
        
        // å…¨å±€å‡½æ•°
        window.testPage = function(pageName) {
            const resultDiv = document.getElementById('page-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<i class="fas fa-spinner fa-spin"></i> æµ‹è¯•é¡µé¢ ${pageName}...`;
            
            fetch(pageName)
                .then(response => {
                    if (response.ok) {
                        resultDiv.className = 'test-result test-success';
                        resultDiv.innerHTML = `<i class="fas fa-check"></i> âœ… ${pageName} åŠ è½½æˆåŠŸ (çŠ¶æ€ç : ${response.status})`;
                    } else {
                        resultDiv.className = 'test-result test-error';
                        resultDiv.innerHTML = `<i class="fas fa-times"></i> âŒ ${pageName} åŠ è½½å¤±è´¥ (çŠ¶æ€ç : ${response.status})`;
                    }
                })
                .catch(error => {
                    resultDiv.className = 'test-result test-error';
                    resultDiv.innerHTML = `<i class="fas fa-times"></i> âŒ ${pageName} åŠ è½½å‡ºé”™: ${error.message}`;
                });
        };
        
        window.testHeroSections = function() {
            const resultDiv = document.getElementById('hero-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ£€æŸ¥ Hero æ ·å¼...';
            
            // æ£€æŸ¥ Hero CSS æ–‡ä»¶æ˜¯å¦å­˜åœ¨
            const heroFiles = [
                'css/hero-ultimate-fix.css',
                'js/hero-ultimate-fix.js'
            ];
            
            let results = [];
            let completed = 0;
            
            heroFiles.forEach(file => {
                fetch(file)
                    .then(response => {
                        completed++;
                        if (response.ok) {
                            results.push(`âœ… ${file} å­˜åœ¨`);
                        } else {
                            results.push(`âŒ ${file} ä¸å­˜åœ¨`);
                        }
                        
                        if (completed === heroFiles.length) {
                            resultDiv.className = 'test-result test-success';
                            resultDiv.innerHTML = `<i class="fas fa-check"></i> Hero æ–‡ä»¶æ£€æŸ¥å®Œæˆ:<br>${results.join('<br>')}`;
                        }
                    })
                    .catch(error => {
                        completed++;
                        results.push(`âŒ ${file} æ£€æŸ¥å‡ºé”™: ${error.message}`);
                        
                        if (completed === heroFiles.length) {
                            resultDiv.className = 'test-result test-warning';
                            resultDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Hero æ–‡ä»¶æ£€æŸ¥å®Œæˆ:<br>${results.join('<br>')}`;
                        }
                    });
            });
        };
        
        window.testSupabaseConnection = async function() {
            const resultDiv = document.getElementById('db-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æµ‹è¯• Supabase è¿æ¥...';
            
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('count', { count: 'exact', head: true });
                
                if (error) {
                    resultDiv.className = 'test-result test-warning';
                    resultDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> âš ï¸ è¿æ¥æˆåŠŸä½†æŸ¥è¯¢å‡ºé”™: ${error.message}`;
                } else {
                    resultDiv.className = 'test-result test-success';
                    resultDiv.innerHTML = `<i class="fas fa-check"></i> âœ… Supabase è¿æ¥æˆåŠŸï¼äº§å“è¡¨è®°å½•æ•°: ${data || 0}`;
                }
            } catch (err) {
                resultDiv.className = 'test-result test-error';
                resultDiv.innerHTML = `<i class="fas fa-times"></i> âŒ Supabase è¿æ¥å¤±è´¥: ${err.message}`;
            }
        };
        
        window.testProductData = async function() {
            const resultDiv = document.getElementById('db-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æµ‹è¯•äº§å“æ•°æ®...';
            
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .limit(5);
                
                if (error) {
                    resultDiv.className = 'test-result test-error';
                    resultDiv.innerHTML = `<i class="fas fa-times"></i> âŒ äº§å“æ•°æ®æŸ¥è¯¢å¤±è´¥: ${error.message}`;
                } else if (!data || data.length === 0) {
                    resultDiv.className = 'test-result test-warning';
                    resultDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> âš ï¸ æ•°æ®åº“ä¸­æš‚æ— äº§å“æ•°æ®`;
                } else {
                    resultDiv.className = 'test-result test-success';
                    resultDiv.innerHTML = `<i class="fas fa-check"></i> âœ… æˆåŠŸè·å– ${data.length} ä¸ªäº§å“æ•°æ®<br>ç¤ºä¾‹äº§å“: ${data[0].name || 'æœªå‘½å'}`;
                }
            } catch (err) {
                resultDiv.className = 'test-result test-error';
                resultDiv.innerHTML = `<i class="fas fa-times"></i> âŒ äº§å“æ•°æ®æµ‹è¯•å¤±è´¥: ${err.message}`;
            }
        };
        
        window.testUnifiedAPI = function() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æµ‹è¯•ç»Ÿä¸€ API...';
            
            if (window.unifiedAPI) {
                resultDiv.className = 'test-result test-success';
                resultDiv.innerHTML = `<i class="fas fa-check"></i> âœ… ç»Ÿä¸€ API å·²åŠ è½½ï¼Œå¯ç”¨æ–¹æ³•: ${Object.keys(window.unifiedAPI).join(', ')}`;
            } else {
                resultDiv.className = 'test-result test-warning';
                resultDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> âš ï¸ ç»Ÿä¸€ API æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ js/unified-api.js`;
            }
        };
        
        window.testContactAPI = function() {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æµ‹è¯•è”ç³»è¡¨å• API...';
            
            // æ¨¡æ‹Ÿè”ç³»è¡¨å•æäº¤
            const testData = {
                name: 'æµ‹è¯•ç”¨æˆ·',
                email: 'test@example.com',
                message: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¶ˆæ¯'
            };
            
            // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„è”ç³»è¡¨å• API
            setTimeout(() => {
                resultDiv.className = 'test-result test-warning';
                resultDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> âš ï¸ è”ç³»è¡¨å• API æµ‹è¯•éœ€è¦å®é™…çš„åç«¯æ¥å£`;
            }, 1000);
        };
        
        window.testAdminLogin = function() {
            const resultDiv = document.getElementById('admin-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æµ‹è¯•ç®¡ç†å‘˜ç™»å½•...';
            
            fetch('admin-login.html')
                .then(response => {
                    if (response.ok) {
                        resultDiv.className = 'test-result test-success';
                        resultDiv.innerHTML = `<i class="fas fa-check"></i> âœ… ç®¡ç†å‘˜ç™»å½•é¡µé¢å¯è®¿é—®`;
                    } else {
                        resultDiv.className = 'test-result test-error';
                        resultDiv.innerHTML = `<i class="fas fa-times"></i> âŒ ç®¡ç†å‘˜ç™»å½•é¡µé¢ä¸å¯è®¿é—®`;
                    }
                })
                .catch(error => {
                    resultDiv.className = 'test-result test-error';
                    resultDiv.innerHTML = `<i class="fas fa-times"></i> âŒ ç®¡ç†å‘˜ç™»å½•æµ‹è¯•å¤±è´¥: ${error.message}`;
                });
        };
        
        window.testAdminDashboard = function() {
            const resultDiv = document.getElementById('admin-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æµ‹è¯•ç®¡ç†é¢æ¿...';
            
            fetch('admin-complete-supabase.html')
                .then(response => {
                    if (response.ok) {
                        resultDiv.className = 'test-result test-success';
                        resultDiv.innerHTML = `<i class="fas fa-check"></i> âœ… ç®¡ç†é¢æ¿é¡µé¢å¯è®¿é—®`;
                    } else {
                        resultDiv.className = 'test-result test-error';
                        resultDiv.innerHTML = `<i class="fas fa-times"></i> âŒ ç®¡ç†é¢æ¿é¡µé¢ä¸å¯è®¿é—®`;
                    }
                })
                .catch(error => {
                    resultDiv.className = 'test-result test-error';
                    resultDiv.innerHTML = `<i class="fas fa-times"></i> âŒ ç®¡ç†é¢æ¿æµ‹è¯•å¤±è´¥: ${error.message}`;
                });
        };
        
        window.checkDeploymentReadiness = function() {
            const resultDiv = document.getElementById('deployment-test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ£€æŸ¥éƒ¨ç½²å‡†å¤‡...';
            
            const requiredFiles = [
                'package.json',
                'vercel.json',
                '.env.local',
                'lib/supabase.js'
            ];
            
            let results = [];
            let completed = 0;
            let allGood = true;
            
            requiredFiles.forEach(file => {
                fetch(file)
                    .then(response => {
                        completed++;
                        if (response.ok) {
                            results.push(`âœ… ${file}`);
                        } else {
                            results.push(`âŒ ${file} ç¼ºå¤±`);
                            allGood = false;
                        }
                        
                        if (completed === requiredFiles.length) {
                            if (allGood) {
                                resultDiv.className = 'test-result test-success';
                                resultDiv.innerHTML = `<i class="fas fa-rocket"></i> ğŸš€ é¡¹ç›®å·²å‡†å¤‡å¥½éƒ¨ç½²ï¼<br>${results.join('<br>')}`;
                            } else {
                                resultDiv.className = 'test-result test-warning';
                                resultDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> âš ï¸ éƒ¨ç½²å‡†å¤‡æ£€æŸ¥:<br>${results.join('<br>')}`;
                            }
                        }
                    })
                    .catch(error => {
                        completed++;
                        results.push(`âŒ ${file} æ£€æŸ¥å‡ºé”™`);
                        allGood = false;
                        
                        if (completed === requiredFiles.length) {
                            resultDiv.className = 'test-result test-warning';
                            resultDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> âš ï¸ éƒ¨ç½²å‡†å¤‡æ£€æŸ¥:<br>${results.join('<br>')}`;
                        }
                    });
            });
        };
    </script>
</body>
</html>