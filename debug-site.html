<!DOCTYPE html>
<html lang="en">
<head>
    <script src="js/global-fix.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED Display Website - Debug Version</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #0056b3;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
        }
        .debug-panel {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .debug-links {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .debug-link {
            display: block;
            padding: 10px;
            background-color: #0056b3;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            text-align: center;
            transition: background-color 0.3s;
        }
        .debug-link:hover {
            background-color: #003d7a;
        }
        .error-log {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            color: #721c24;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        pre {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            overflow-x: auto;
        }
        button {
            padding: 10px 15px;
            background-color: #0056b3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #003d7a;
        }
    </style>
</head>
<body>
    <h1>LED Display Website - Debug Version</h1>
    
    <div class="debug-panel">
        <h2>Debug Tools</h2>
        <div>
            <button id="checkEncoding">Check File Encoding</button>
            <button id="testScripts">Test JavaScript Files</button>
            <button id="fixBoundingClientRect">Apply getBoundingClientRect Fix</button>
            <button id="clearErrors">Clear Error Log</button>
        </div>
    </div>
    
    <div class="debug-panel">
        <h2>Website Pages</h2>
        <p>Click on any page to open it in debug mode:</p>
        <div class="debug-links">
            <a href="index.html?debug=true" class="debug-link" target="_blank">Home Page</a>
            <a href="homepage.html?debug=true" class="debug-link" target="_blank">Homepage</a>
            <a href="about.html?debug=true" class="debug-link" target="_blank">About</a>
            <a href="products.html?debug=true" class="debug-link" target="_blank">Products</a>
            <a href="contact.html?debug=true" class="debug-link" target="_blank">Contact</a>
            <a href="fine-pitch.html?debug=true" class="debug-link" target="_blank">Fine Pitch</a>
            <a href="outdoor.html?debug=true" class="debug-link" target="_blank">Outdoor</a>
            <a href="rental.html?debug=true" class="debug-link" target="_blank">Rental</a>
            <a href="creative.html?debug=true" class="debug-link" target="_blank">Creative</a>
            <a href="transparent.html?debug=true" class="debug-link" target="_blank">Transparent</a>
            <a href="solutions.html?debug=true" class="debug-link" target="_blank">Solutions</a>
            <a href="cases.html?debug=true" class="debug-link" target="_blank">Cases</a>
            <a href="news.html?debug=true" class="debug-link" target="_blank">News</a>
            <a href="support.html?debug=true" class="debug-link" target="_blank">Support</a>
        </div>
    </div>
    
    <div class="debug-panel">
        <h2>Error Log</h2>
        <div id="errorLog" class="error-log">
            <p>No errors logged yet. Click on a page link to start debugging.</p>
        </div>
    </div>
    
    <div class="debug-panel">
        <h2>JavaScript Patch</h2>
        <p>Copy this script and add it to the &lt;head&gt; section of any HTML file that has JavaScript errors:</p>
        <pre id="patchCode">
&lt;script&gt;
// Comprehensive JavaScript error handling patch
(function() {
    // Save the original method
    if (window.Element && Element.prototype.getBoundingClientRect) {
        window.Element.prototype.originalGetBoundingClientRect = Element.prototype.getBoundingClientRect;
        
        // Override with a safe version
        Element.prototype.getBoundingClientRect = function() {
            try {
                return this.originalGetBoundingClientRect.apply(this);
            } catch (error) {
                console.warn('Error in getBoundingClientRect, returning default values');
                return {
                    top: 0, right: 0, bottom: 0, left: 0,
                    width: 0, height: 0, x: 0, y: 0
                };
            }
        };
    }
    
    // Add a global error handler
    window.addEventListener('error', function(event) {
        console.warn('Caught error:', event.error);
        
        // Log the error if in debug mode
        if (window.location.search.includes('debug=true')) {
            const errorDiv = document.createElement('div');
            errorDiv.style.padding = '10px';
            errorDiv.style.margin = '10px 0';
            errorDiv.style.backgroundColor = '#f8d7da';
            errorDiv.style.border = '1px solid #f5c6cb';
            errorDiv.style.borderRadius = '4px';
            errorDiv.style.color = '#721c24';
            
            const errorMessage = document.createElement('p');
            errorMessage.textContent = 'Error: ' + (event.error ? event.error.message : event.message);
            errorDiv.appendChild(errorMessage);
            
            const errorLocation = document.createElement('p');
            errorLocation.textContent = 'Location: ' + (event.filename || 'unknown') + ':' + (event.lineno || '0') + ':' + (event.colno || '0');
            errorDiv.appendChild(errorLocation);
            
            if (event.error && event.error.stack) {
                const errorStack = document.createElement('pre');
                errorStack.textContent = event.error.stack;
                errorStack.style.fontSize = '12px';
                errorStack.style.overflow = 'auto';
                errorStack.style.maxHeight = '200px';
                errorDiv.appendChild(errorStack);
            }
            
            document.body.insertBefore(errorDiv, document.body.firstChild);
            
            // Also send to parent if in iframe
            if (window.parent && window.parent !== window) {
                try {
                    window.parent.postMessage({
                        type: 'jsError',
                        message: event.error ? event.error.message : event.message,
                        location: (event.filename || 'unknown') + ':' + (event.lineno || '0') + ':' + (event.colno || '0'),
                        stack: event.error ? event.error.stack : null,
                        url: window.location.href
                    }, '*');
                } catch (e) {
                    console.error('Failed to send error to parent window', e);
                }
            }
        }
        
        // Prevent the error from showing in console in production
        if (!window.location.search.includes('debug=true')) {
            event.preventDefault();
        }
    });
    
    // Add a global unhandled promise rejection handler
    window.addEventListener('unhandledrejection', function(event) {
        console.warn('Unhandled promise rejection:', event.reason);
        
        // Log the error if in debug mode
        if (window.location.search.includes('debug=true')) {
            const errorDiv = document.createElement('div');
            errorDiv.style.padding = '10px';
            errorDiv.style.margin = '10px 0';
            errorDiv.style.backgroundColor = '#fff3cd';
            errorDiv.style.border = '1px solid #ffeeba';
            errorDiv.style.borderRadius = '4px';
            errorDiv.style.color = '#856404';
            
            const errorMessage = document.createElement('p');
            errorMessage.textContent = 'Unhandled Promise Rejection: ' + (event.reason ? (event.reason.message || event.reason) : 'Unknown reason');
            errorDiv.appendChild(errorMessage);
            
            if (event.reason && event.reason.stack) {
                const errorStack = document.createElement('pre');
                errorStack.textContent = event.reason.stack;
                errorStack.style.fontSize = '12px';
                errorStack.style.overflow = 'auto';
                errorStack.style.maxHeight = '200px';
                errorDiv.appendChild(errorStack);
            }
            
            document.body.insertBefore(errorDiv, document.body.firstChild);
        }
        
        // Prevent the error from showing in console in production
        if (!window.location.search.includes('debug=true')) {
            event.preventDefault();
        }
    });
    
    // Safe querySelector and querySelectorAll
    const originalQuerySelector = Document.prototype.querySelector;
    Document.prototype.querySelector = function(selector) {
        try {
            return originalQuerySelector.call(this, selector);
        } catch (error) {
            console.warn('Error in querySelector with selector:', selector, error);
            return null;
        }
    };
    
    const originalQuerySelectorAll = Document.prototype.querySelectorAll;
    Document.prototype.querySelectorAll = function(selector) {
        try {
            return originalQuerySelectorAll.call(this, selector);
        } catch (error) {
            console.warn('Error in querySelectorAll with selector:', selector, error);
            return [];
        }
    };
    
    console.log('✓ Comprehensive JavaScript error handling patch applied');
})();
&lt;/script&gt;
        </pre>
    </div>
    
    <script>
        // Listen for error messages from iframes
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'jsError') {
                const errorLog = document.getElementById('errorLog');
                const errorEntry = document.createElement('div');
                errorEntry.innerHTML = `
                    <h3>Error in ${event.data.url}</h3>
                    <p><strong>Message:</strong> ${event.data.message}</p>
                    <p><strong>Location:</strong> ${event.data.location}</p>
                    ${event.data.stack ? `<pre>${event.data.stack}</pre>` : ''}
                    <hr>
                `;
                errorLog.appendChild(errorEntry);
                errorLog.scrollTop = errorLog.scrollHeight;
            }
        });
        
        // Check file encoding button
        document.getElementById('checkEncoding').addEventListener('click', function() {
            const errorLog = document.getElementById('errorLog');
            errorLog.innerHTML = '<p>Checking file encoding...</p>';
            
            fetch('check_encoding.php')
                .then(response => response.text())
                .then(data => {
                    errorLog.innerHTML = data;
                })
                .catch(error => {
                    errorLog.innerHTML = `<p>Error checking encoding: ${error.message}</p>
                    <p>You can manually run the encoding fix script:</p>
                    <pre>python fix_encoding_comprehensive.py</pre>`;
                });
        });
        
        // Test JavaScript files button
        document.getElementById('testScripts').addEventListener('click', function() {
            const errorLog = document.getElementById('errorLog');
            errorLog.innerHTML = '<p>Testing JavaScript files...</p>';
            
            // Create an iframe to test scripts
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            const scripts = ['js/script.js', 'js/script-fixed.js', 'js/admin-api.js', 'js/admin-sync.js'];
            let results = '';
            
            scripts.forEach(script => {
                try {
                    const scriptElement = iframe.contentDocument.createElement('script');
                    scriptElement.src = script;
                    iframe.contentDocument.head.appendChild(scriptElement);
                    results += `<p class="success">✓ Successfully loaded: ${script}</p>`;
                } catch (error) {
                    results += `<p>✗ Error loading: ${script} - ${error.message}</p>`;
                }
            });
            
            errorLog.innerHTML = results;
            document.body.removeChild(iframe);
        });
        
        // Apply getBoundingClientRect fix button
        document.getElementById('fixBoundingClientRect').addEventListener('click', function() {
            const errorLog = document.getElementById('errorLog');
            errorLog.innerHTML = '<p>Applying getBoundingClientRect fix...</p>';
            
            fetch('apply_fix.php')
                .then(response => response.text())
                .then(data => {
                    errorLog.innerHTML = data;
                })
                .catch(error => {
                    errorLog.innerHTML = `<p>Error applying fix: ${error.message}</p>
                    <p>You can manually run the fix script:</p>
                    <pre>python fix_getboundingclientrect.py</pre>`;
                });
        });
        
        // Clear error log button
        document.getElementById('clearErrors').addEventListener('click', function() {
            document.getElementById('errorLog').innerHTML = '<p>Error log cleared.</p>';
        });
    </script>
</body>
</html>